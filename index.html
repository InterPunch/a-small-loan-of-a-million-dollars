<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Small Loan Dodge</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; font-family: sans-serif; }
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: white; z-index: 10;
        }
        #score-ui {
            position: absolute; top: 20px; left: 20px; color: gold; font-size: 30px;
            font-weight: bold; pointer-events: none; z-index: 5; text-shadow: 2px 2px #000;
        }
        button { padding: 15px 30px; font-size: 20px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

<div id="score-ui">Score: 0</div>
<div id="overlay">
    <h1>3D LOAN DODGER</h1>
    <p>Use Arrow Keys to move the Blue Cube</p>
    <button onclick="startGame()">START GAME</button>
</div>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
</script>

<script type="module">
    import * as THREE from 'three';

    let scene, camera, renderer, player, score = 0;
    let gameRunning = false;
    let enemies = [];
    let enemyFrequency = 0.02;
    const loanSound = new Audio("https://www.myinstants.com/media/sounds/small-loan-of-a-million-dollars.mp3");

    // Initialize Scene
    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x111111);
        
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, -5);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lights
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // Floor
        const floorGeo = new THREE.PlaneGeometry(10, 100);
        const floorMat = new THREE.MeshPhongMaterial({ color: 0x222222 });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // Player Cube
        const playerGeo = new THREE.BoxGeometry(1, 1, 1);
        const playerMat = new THREE.MeshPhongMaterial({ color: 0x3498db });
        player = new THREE.Mesh(playerGeo, playerMat);
        player.position.y = 0.5;
        scene.add(player);
    }

    // Input Handling
    const keys = {};
    window.addEventListener('keydown', (e) => keys[e.code] = true);
    window.addEventListener('keyup', (e) => keys[e.code] = false);

    const textureLoader = new THREE.TextureLoader();
    const trumpTex = textureLoader.load('https://upload.wikimedia.org/wikipedia/commons/thumb/5/56/Donald_Trump_official_portrait.jpg/120px-Donald_Trump_official_portrait.jpg');

    function spawnEnemy() {
        if (Math.random() < enemyFrequency) {
            const geo = new THREE.BoxGeometry(1.2, 1.5, 0.5);
            // Front face gets the texture, others are red
            const mats = [
                new THREE.MeshPhongMaterial({color: 0xff0000}), // right
                new THREE.MeshPhongMaterial({color: 0xff0000}), // left
                new THREE.MeshPhongMaterial({color: 0xff0000}), // top
                new THREE.MeshPhongMaterial({color: 0xff0000}), // bottom
                new THREE.MeshPhongMaterial({map: trumpTex}),  // front
                new THREE.MeshPhongMaterial({color: 0xff0000}), // back
            ];
            const enemy = new THREE.Mesh(geo, mats);
            enemy.position.set((Math.random() - 0.5) * 8, 0.75, -50);
            scene.add(enemy);
            enemies.push({ mesh: enemy, playedSound: false });
            
            // Comedic sound logic
            const soundClone = loanSound.cloneNode();
            soundClone.volume = 0.5;
            soundClone.play();
        }
    }

    function animate() {
        if (!gameRunning) return;
        requestAnimationFrame(animate);

        // Player Move
        if (keys['ArrowLeft'] && player.position.x > -4.5) player.position.x -= 0.15;
        if (keys['ArrowRight'] && player.position.x < 4.5) player.position.x += 0.15;

        // Enemy Update
        for (let i = enemies.length - 1; i >= 0; i--) {
            enemies[i].mesh.position.z += 0.3;

            // Collision Detection
            const box1 = new THREE.Box3().setFromObject(player);
            const box2 = new THREE.Box3().setFromObject(enemies[i].mesh);
            if (box1.intersectsBox(box2)) {
                gameOver();
            }

            // Cleanup
            if (enemies[i].mesh.position.z > 10) {
                scene.remove(enemies[i].mesh);
                enemies.splice(i, 1);
                score++;
                document.getElementById('score-ui').innerText = `Score: ${score}`;
                enemyFrequency += 0.0002;
            }
        }

        spawnEnemy();
        renderer.render(scene, camera);
    }

    function gameOver() {
        gameRunning = false;
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('overlay').innerHTML = `<h1>YOU GOT BANKRUPTED</h1><p>Score: ${score}</p><button onclick="location.reload()">RETRY</button>`;
    }

    window.startGame = () => {
        document.getElementById('overlay').style.display = 'none';
        gameRunning = true;
        animate();
    };

    init();
    renderer.render(scene, camera); // Initial render
</script>
</body>
</html>
